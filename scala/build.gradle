/*
 * This file was generated by the Gradle "init" task.
 *
 * This generated file contains a sample Scala library project to get you started.
 * For more details take a look at the Scala plugin chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.3.1/userguide/scala_plugin.html
 */


plugins {
    // Apply the scala plugin to add support for Scala
    id 'scala'
}

ext {
    scalaVersion = "2.11"
    akkaVersion = "2.5.0"
    sparkVersion = "2.2.0"
}

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenLocal()
    mavenCentral()
    maven {
        url "https://oss.sonatype.org/content/repositories/snapshots"
    }
}



task getHomeDir {
    doLast {
        println gradle.gradleHomeDir
    }
}

configurations {
    provided
    compile.extendsFrom provided
}

sourceSets {
    main.compileClasspath += configurations.provided
    test.compileClasspath += configurations.provided
    test.runtimeClasspath += configurations.provided
}

//TODO use variable for library versions

dependencies {
    // Use Scala 2.12 in our library project
    implementation "org.scala-lang:scala-library:2.11.11"

    // Use Scalatest for testing our library
    testImplementation "junit:junit:4.12"
    testImplementation "org.scalatest:scalatest_$scalaVersion:3.0.5"

    // https://mvnrepository.com/artifact/org.scalatest/scalatest
    testCompile group: "org.scalatest", name: "scalatest_$scalaVersion", version: "3.2.0-SNAP10"

    compile group: "org.scalatest", name: "scalatest_$scalaVersion", version: "3.2.0-SNAP10"

    // Need scala-xml at test runtime
    testRuntimeOnly "org.scala-lang.modules:scala-xml_$scalaVersion:1.1.1"


    // https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor
    compile group: "com.typesafe.akka", name: "akka-actor_$scalaVersion", version: "2.5.0"


    provided "org.apache.spark:spark-mllib_$scalaVersion:$sparkVersion"
    provided "org.apache.spark:spark-sql_$scalaVersion:$sparkVersion"

    provided "org.apache.spark:spark-graphx_$scalaVersion:$sparkVersion"
    provided "org.apache.spark:spark-launcher_$scalaVersion:$sparkVersion"
    provided "org.apache.spark:spark-catalyst_$scalaVersion:$sparkVersion"
    provided "org.apache.spark:spark-core_$scalaVersion:$sparkVersion"

    compile group: "commons-io", name: "commons-io", version: "2.5"

    //Streaming

    compile "org.apache.spark:spark-streaming-flume-assembly_$scalaVersion:$sparkVersion"
    compile "org.apache.spark:spark-streaming_$scalaVersion:$sparkVersion"

    // https://mvnrepository.com/artifact/org.apache.spark/spark-streaming-kafka-0-10-assembly
    provided group: "org.apache.spark", name: "spark-streaming-kafka-0-10-assembly_2.11", version: "2.2.0"


    // https://mvnrepository.com/artifact/org.apache.spark/spark-sql-kafka-0-10
    provided group: "org.apache.spark", name: "spark-sql-kafka-0-10_2.11", version: "2.2.0"

    // https://mvnrepository.com/artifact/org.apache.kafka/kafka
    compile group: "org.apache.kafka", name: "kafka_2.11", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients
    compile group: "org.apache.kafka", name: "kafka-clients", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/kafka-streams
    compile group: "org.apache.kafka", name: "kafka-streams", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/connect-api
    compile group: "org.apache.kafka", name: "connect-api", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/connect-json
    compile group: "org.apache.kafka", name: "connect-json", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/connect-runtime
    compile group: "org.apache.kafka", name: "connect-runtime", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/kafka-streams-scala
    compile group: "org.apache.kafka", name: "kafka-streams-scala_$scalaVersion", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/connect-transforms
    compile group: "org.apache.kafka", name: "connect-transforms", version: "$sparkVersion"
    // https://mvnrepository.com/artifact/org.apache.kafka/connect-file
    compile group: "org.apache.kafka", name: "connect-file", version: "$sparkVersion"

    // https://mvnrepository.com/artifact/org.apache.spark/spark-streaming-kafka-0-10
    compile group: "org.apache.spark", name: "spark-streaming-kafka-0-10_2.11", version: "$sparkVersion"

    //Json
    // https://mvnrepository.com/artifact/io.spray/spray-json
    compile group: "io.spray", name: "spray-json_$scalaVersion", version: "1.3.5"

    //Akka
    // https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor
    compile group: "com.typesafe.akka", name: "akka-actor_$scalaVersion", version: "2.5.0"
    // https://mvnrepository.com/artifact/com.typesafe.akka/akka-testkit
    testCompile group: "com.typesafe.akka", name: "akka-testkit_$scalaVersion", version: "2.5.0"
    // https://mvnrepository.com/artifact/com.typesafe.akka/akka-http
    compile group: "com.typesafe.akka", name: "akka-http_$scalaVersion", version: "10.1.8"
    // https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-testkit
    testCompile group: "com.typesafe.akka", name: "akka-http-testkit_$scalaVersion", version: "10.1.8"

}

task fatJar(type: Jar) {
    zip64 true
    classifier = "all"
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar

    exclude 'META-INF/*.RSA', 'META-INF/*.SF','META-INF/*.DSA'
    manifest {
        attributes 'Main-Class': 'com.test.Main'
    }
}

jar {
    dependsOn configurations.runtime
    from { 
        (configurations.runtime - configurations.provided).collect 
                { 
                    it.isDirectory()? it : zipTree(it) 
                } 
    } { 
        exclude 'META-INF/*.RSA' 
        exclude 'META-INF/*.SF' 
        exclude 'META-INF/*.DSA' 
    } 
    manifest { 
        attributes 'Main-Class': 'com.test.Main' 
    } 
}